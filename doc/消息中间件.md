# 消息中间件

## 高可用

### rabbitMq(镜像集群)

镜像自动同步全量数据

## 不丢数据怎么做到

### 生产者丢

+ 基于事务，会阻塞
+ 设成channel.confirm 回调通知

### mq丢

+ 开启持久化 保存到磁盘后才ack生产者

### 消费者丢

+ 不开启autoAck 就不会丢失

### 如何保证消费的幂等性

+ 缓存
+ 数据库唯一键

### 如何保证消费顺序

+ 依次发到一个队列中

### 生产事故！几百万消息在消息队列里积压了几个小时



### 过期时间

一般不允许设置过期时间，定时任务重新发